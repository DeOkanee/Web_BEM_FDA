<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BEM FDA OFFICIAL 2024</title>
    <link rel="stylesheet" href="css/login.css" />
    <link rel="icon" href="img logo/ICON BEM FDA.png" type="image/x-icon" />

    <!-- Sweet Alert CSS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
    />
  </head>
  <body>
    <header>
      <div
        class="logo-left"
        onclick="window.open('https://uhnsugriwa.ac.id/');"
        style="cursor: pointer"
      >
        <img src="img logo/LOGO UHN.png" alt="Logo Left" />
      </div>
      <div class="title">
        <h1>
          <img src="img logo/ICON BEM FDA.png" alt="BEM FDA" class="icon-bem" />
          BEM FDA OFFICIAL
        </h1>
      </div>
      <div
        class="logo-right"
        onclick="window.open('https://www.instagram.com/orkemas_fda/');"
        style="cursor: pointer"
      >
        <img src="img logo/LOGO ORKEMAS.png" alt="Logo Right" />
      </div>
    </header>

    <div class="container">
      <div class="img-wrapper">
        <img src="/img logo/ICON BEM FDA.png" alt="BEM FDA" />
      </div>
      <div class="heading">Sign In</div>
      <span>Masuk ke laman Web BEM FDA</span>
      <form
        id="loginForm"
        class="form"
        action="https://script.google.com/macros/s/AKfycbwUNBL_Stce7WjiLOrQGqVACuWpBegDl0_fGdkymVIbmlzvHaRwMH1fazpmxUofeg4LBA/exec"
        method="post"
        enctype="multipart/form-data"
      >
        <input
          placeholder="Username"
          id="username"
          name="Username"
          type="text"
          class="input"
        />
        <input
          placeholder="E-mail"
          id="email"
          name="Email"
          type="email"
          class="input"
        />
        <input value="Sign In" type="submit" class="login-button" />
      </form>
    </div>

    <!-- Sweet Alert JavaScript -->
  <!-- login.html -->

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Check if user is already logged in
    const storedData = localStorage.getItem("bemFdaLoginData");
    if (storedData) {
      const data = JSON.parse(storedData);
      // Automatically log in and redirect to home page
      window.location.href = "/home.html";
    }

    document.getElementById("loginForm").addEventListener("submit", function (event) {
      event.preventDefault();

      // Validasi input sebelum mengirimkan data
      const username = document.getElementById("username").value.trim();
      const email = document.getElementById("email").value.trim();

      if (username === "" || email === "") {
        // Jika ada input yang kosong, tampilkan Sweet Alert error
        Swal.fire({
          icon: "error",
          title: "Oops...",
          text: "Data masih kosong! Mohon lengkapi data.",
        });
        return; // Stop further execution
      }

      // Ubah teks tombol menjadi "Logging In"
      const loginButton = document.querySelector(".login-button");
      loginButton.value = "Logging In...";

      // Kirim data menggunakan fetch atau XMLHttpRequest
      fetch(
        "https://script.google.com/macros/s/AKfycbwUNBL_Stce7WjiLOrQGqVACuWpBegDl0_fGdkymVIbmlzvHaRwMH1fazpmxUofeg4LBA/exec",
        {
          method: "POST",
          body: new FormData(document.getElementById("loginForm")),
          enctype: "multipart/form-data",
        }
      )
       .then((response) => {
          if (response.ok) {
            // Jika sukses, tampilkan Sweet Alert success
            const Toast = Swal.mixin({
              toast: true,
              position: "top-end",
              showConfirmButton: false,
              timer: 3000,
              timerProgressBar: true,
              didOpen: (toast) => {
                toast.addEventListener("mouseenter", Swal.stopTimer);
                toast.addEventListener("mouseleave", Swal.resumeTimer);
              },
            });
            Toast.fire({
              icon: "success",
              title: "Signed in successfully",
            });

            // Store user login data locally
            const loginData = { username, email };
            localStorage.setItem("bemFdaLoginData", JSON.stringify(loginData));

            // Redirect ke halaman "/home.html" setelah 3 detik
            setTimeout(() => {
              window.location.href = "/home.html";
            }, 3000);
          } else {
            // Jika ada kesalahan
            throw new Error("Network response was not ok.");
          }
        })
       .catch((error) => {
          console.error("Error:", error);
          // Tambahkan kode untuk menampilkan pesan error jika diperlukan
        })
       .finally(() => {
          // Setelah selesai, ubah teks tombol kembali menjadi "Sign In"
          loginButton.value = "Sign In";
        });
    });
  });
</script>
  </body>
</html>
